<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nullrootvector.dev</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            color: #E0E0E0;
            margin: 0;
            overflow: hidden;
            background-color: #0a0a0a;
        }
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .terminal-window {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(10, 10, 10, 0.65);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            animation: float-animation 6s ease-in-out infinite;
        }
        /* Hide scrollbar */
        #terminal-body {
            scrollbar-width: none; /* Firefox */
        }
        #terminal-body::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        .terminal-header {
            background-color: rgba(45, 45, 45, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: move;
        }
        #terminal-input {
            background: transparent;
            border: none;
            outline: none;
            color: #E0E0E0;
            flex-grow: 1;
            caret-color: #22c55e;
        }
        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
        @keyframes float-animation {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
    </style>
</head>
<body class="bg-black">

    <canvas id="bg-canvas"></canvas>

    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="terminal-window w-full max-w-4xl h-[32rem] rounded-lg shadow-2xl flex flex-col">
            <!-- Terminal Header -->
            <div class="terminal-header h-8 flex items-center px-3 flex-shrink-0">
                <div class="flex space-x-2">
                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                </div>
                <div class="flex-grow text-center text-sm text-gray-400">
                    root@nullrootvector:~
                </div>
            </div>

            <!-- Terminal Body -->
            <div id="terminal-body" class="p-4 md:p-6 text-sm md:text-base flex-grow overflow-y-auto" onclick="document.getElementById('terminal-input').focus()">
                <div id="output"></div>
                <div id="input-line" class="flex items-center mt-4">
                    <p id="prompt" class="text-green-400 flex-shrink-0">root@nullrootvector:~$</p>
                    <input type="text" id="terminal-input" class="ml-2" autofocus />
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Three.js Starfield Background ---
        let scene, camera, renderer, stars;

        function initStars() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.z = 1;

            renderer = new THREE.WebGLRenderer({
                canvas: document.getElementById('bg-canvas'),
                antialias: true,
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000, 1);

            const starGeo = new THREE.BufferGeometry();
            const starVertices = [];
            for (let i = 0; i < 15000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starVertices.push(x, y, z);
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            
            let starMaterial = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.7 });
            stars = new THREE.Points(starGeo, starMaterial);
            scene.add(stars);

            animateStars();
        }

        function animateStars() {
            stars.rotation.y += 0.0001;
            stars.rotation.x += 0.0001;
            renderer.render(scene, camera);
            requestAnimationFrame(animateStars);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.addEventListener('resize', onWindowResize, false);
        initStars();

        // --- Terminal Logic ---
        const input = document.getElementById('terminal-input');
        const output = document.getElementById('output');
        const terminalBody = document.getElementById('terminal-body');
        const promptEl = document.getElementById('prompt');
        const inputLine = document.getElementById('input-line');
        
        let commandState = null; // For multi-step commands
        let blogPosts = {};
        let isAuthenticated = false;

        async function checkAuth() {
            try {
                const response = await fetch('/api/check-auth');
                if (response.ok) {
                    isAuthenticated = true;
                } else {
                    isAuthenticated = false;
                }
            } catch (error) {
                isAuthenticated = false;
            }
        }

        async function fetchBlogPosts() {
            try {
                const response = await fetch('/api/posts');
                blogPosts = await response.json();
            } catch (error) {
                console.error('Error fetching blog posts:', error);
            }
        }
        
        function handleInquiry(userInput) {
            const step = commandState.step;
            const prompts = ["Enter your name:", "Enter your email:", "Enter your message/question:"];
            
            // Log the user's answer to the previous prompt
            output.innerHTML += `<div><span class="text-gray-400">${prompts[step-1]}</span> ${userInput}</div>`;

            if (step === 1) {
                commandState.data.name = userInput;
                commandState.step++;
                promptEl.textContent = prompts[commandState.step - 1];
            } else if (step === 2) {
                commandState.data.email = userInput;
                commandState.step++;
                promptEl.textContent = prompts[commandState.step - 1];
            } else if (step === 3) {
                commandState.data.message = userInput;
                
                fetch("/api/inquire", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(commandState.data),
                }).then(response => {
                    if (response.ok) {
                        output.innerHTML += `<div class="mt-2">Thank you for your inquiry!</div>`;
                    } else {
                        output.innerHTML += `<div class="mt-2">There was an error submitting your inquiry.</div>`;
                    }
                    resetCommandState();
                });
            }
        }

        function handleLogin(userInput) {
            const step = commandState.step;
            const prompts = ["Enter your username:", "Enter your password:"];

            output.innerHTML += `<div><span class="text-gray-400">${prompts[step-1]}</span> ${userInput}</div>`;

            if (step === 1) {
                commandState.data.username = userInput;
                commandState.step++;
                promptEl.textContent = prompts[commandState.step - 1];
            } else if (step === 2) {
                commandState.data.password = userInput;
                
                fetch("/api/signin", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(commandState.data),
                }).then(response => {
                    if (response.ok) {
                        output.innerHTML += `<div class="mt-2">Login successful!</div>`;
                        isAuthenticated = true;
                    } else {
                        output.innerHTML += `<div class="mt-2">Login failed.</div>`;
                    }
                    resetCommandState();
                });
            }
        }

        function handleSignup(userInput) {
            const step = commandState.step;
            const prompts = ["Enter your username:", "Enter your password:", "Enter your invitation code:"];

            output.innerHTML += `<div><span class="text-gray-400">${prompts[step-1]}</span> ${userInput}</div>`;

            if (step === 1) {
                commandState.data.username = userInput;
                commandState.step++;
                promptEl.textContent = prompts[commandState.step - 1];
            } else if (step === 2) {
                commandState.data.password = userInput;
                commandState.step++;
                promptEl.textContent = prompts[commandState.step - 1];
            } else if (step === 3) {
                commandState.data.invitationCode = userInput;
                
                fetch("/api/signup", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(commandState.data),
                }).then(response => {
                    if (response.ok) {
                        output.innerHTML += `<div class="mt-2">Signup successful! You can now log in.</div>`;
                    } else {
                        output.innerHTML += `<div class="mt-2">Signup failed.</div>`;
                    }
                    resetCommandState();
                });
            }
        }

        async function handleChat(userInput) {
            output.innerHTML += `<div><span class="text-gray-400">chat> </span> ${userInput}</div>`;

            const evtSource = new EventSource("/api/chat?prompt=" + userInput);
            let chatOutput = document.createElement('div');
            chatOutput.classList.add('pl-2');
            output.appendChild(chatOutput);

            evtSource.onmessage = function(event) {
                chatOutput.innerHTML += event.data;
                terminalBody.scrollTop = terminalBody.scrollHeight;
            };

            evtSource.onerror = function(err) {
                evtSource.close();
            };
        }

        function resetCommandState() {
             commandState = null;
             promptEl.textContent = "root@nullrootvector:~$ ";
        }

        const commands = {
            fetch: {
                description: 'Displays system information.',
                execute: async () => {
                    const imageUrl = 'pfp.jpeg';
                    const profileImage = `<img src="${imageUrl}" alt="Profile Picture" class="w-32 h-32 md:w-40 md:h-40 rounded-lg object-cover" onerror="this.onerror=null;this.src='https://placehold.co/160/1a1a1a/e0e0e0?text=nullroot'">`;
                    
                    const response = await fetch('/api/sysinfo');
                    const data = await response.json();

                    const sysInfo = `
                        <div>
                            <p><span class="text-indigo-400 font-bold">root</span>@<span class="text-gray-300">nullrootvector</span></p>
                            <p class="text-gray-300">-------------------</p>
                            <p><span class="text-indigo-400 font-bold">OS</span>:     <span class="text-gray-300">${data.os} ${data.arch}</span></p>
                            <p><span class="text-indigo-400 font-bold">Host</span>:   <span class="text-gray-300">Leviathan 7</span></p>
                            <p><span class="text-indigo-400 font-bold">Kernel</span>: <span class="text-gray-300">${data.kernelVersion}</span></p>
                            <p><span class="text-indigo-400 font-bold">Shell</span>:  <span class="text-gray-300">nrv-shell v4.2</span></p>
                            <p><span class="text-indigo-400 font-bold">CPU</span>:    <span class="text-gray-300">${data.cpuName} (${data.numCpu} cores)</span></p>
                            <p><span class="text-indigo-400 font-bold">Usage</span>:  <span class="text-gray-300">${data.loadAvg}</span></p>
                            <p><span class="text-indigo-400 font-bold">Memory</span>: <span class="text-gray-300">${data.memUsed} / ${data.memTotal}</span></p>
                        </div>`;

                    return `<div class="flex flex-col md:flex-row gap-4 md:gap-8 items-center">${profileImage}${sysInfo}</div>`;
                }
            },
            stats: {
                description: 'Displays website statistics.',
                execute: async () => {
                    const response = await fetch('/api/stats');
                    const data = await response.json();
                    let projectCount = 0;
                    try {
                        const projectsResponse = await fetch('/api/projects');
                        const projects = await projectsResponse.json();
                        projectCount = projects.length;
                    } catch (e) {}
                    let postCount = 0;
                    try {
                        const postsResponse = await fetch('/api/posts');
                        const posts = await postsResponse.json();
                        postCount = Object.keys(posts).length;
                    } catch (e) {}

                    return `<p>Unique visitors: ${data.visitors}</p><p>Projects: ${projectCount}</p><p>Blog posts: ${postCount}</p>`;
                }
            },
            whoami: {
                description: 'Displays a short biography.',
                execute: () => `
                    <div class="mt-2">
                        <h1 class="text-2xl font-bold text-amber-400">Angel</h1>
                        <p class="mt-1 text-pink-400">Systems & Computer Architecture Engineer</p>
                        <p class="mt-4 text-gray-300">
                            Greetings. I am a Texas-based engineer focused on designing and building robust, scalable systems. My journey, rooted in cybersecurity, instilled a deep appreciation for secure and resilient architecture. Today, I channel that expertise into creating elegant web applications and powerful backend services, primarily with Golang. When not architecting systems, I enjoy spending time with my Labrador, Artemis, and playing the piano.
                        </p>
                    </div>`
            },
            contact: {
                description: 'Shows contact information.',
                execute: () => `
                    <ul class="list-none space-y-1">
                        <li><span class="text-teal-400 w-20 inline-block">Email:</span> <a href="mailto:angel@nullrootvector.dev" class="text-blue-400 hover:underline">angel@nullrootvector.dev</a></li>
                        <li><span class="text-teal-400 w-20 inline-block">GitHub:</span> <a href="https://github.com/nullrootvector" target="_blank" class="text-blue-400 hover:underline">nullrootvector</a></li>
                        <li><span class="text-teal-400 w-20 inline-block">YouTube:</span> <a href="https://www.youtube.com/@nullrootvector" target="_blank" class="text-blue-400 hover:underline">@nullrootvector</a></li>
                        <li><span class="text-teal-400 w-20 inline-block">Phone:</span> <span class="text-gray-300">+1 (321) 234-6071</span></li>
                    </ul>`
            },
            projects: {
                description: 'Lists current projects.',
                execute: async () => {
                    const response = await fetch('/api/projects');
                    const projects = await response.json();
                    let projectList = '<ul class="list-none">';
                    for (const p of projects) {
                        projectList += `<li><a href="${p.url}" target="_blank" class="text-yellow-400 hover:underline">drwxr-xr-x  ${p.name}</a></li>`;
                    }
                    projectList += '</ul>';
                    return projectList;
                }
            },
            blog: {
                description: 'Read project write-ups. Usage: blog [read, ls]',
                execute: (args) => {
                    const action = args[0];
                    const slug = args[1];

                    if (action === 'read' && slug && blogPosts[slug]) {
                        return blogPosts[slug].content;
                    } 
                    
                    if (action === 'ls' || !action) {
                         let postList = '<p>Available posts:</p><ul class="list-none mt-1">';
                         for (const key in blogPosts) {
                             postList += `<li><span class="text-gray-400">${blogPosts[key].date}</span> - <span class="text-amber-400 cursor-pointer hover:underline" onclick="document.getElementById('terminal-input').value='blog read ${key}'; document.getElementById('terminal-input').dispatchEvent(new KeyboardEvent('keydown', {'key': 'Enter'}))">${blogPosts[key].title}</span></li>`;
                         }
                         postList += '</ul>';
                         return postList;
                    }

                    return `<p>Usage: blog &lt;ls | read [slug]&gt;</p><p>Post not found: ${slug}</p>`;
                }
            },
            login: {
                description: 'Login to the system. Usage: login',
                execute: () => {
                    commandState = { command: 'login', step: 1, data: {} };
                    promptEl.textContent = "Enter your username:";
                    return 'Starting login process... (type "cancel" to exit at any time)';
                }
            },
            signup: {
                description: 'Sign up for a new account. Usage: signup',
                execute: () => {
                    commandState = { command: 'signup', step: 1, data: {} };
                    promptEl.textContent = "Enter your username:";
                    return 'Starting signup process... (type "cancel" to exit at any time)';
                }
            },
            chat: {
                description: 'Chat with an AI assistant. Usage: chat',
                execute: () => {
                    if (!isAuthenticated) {
                        return '<p>You must be logged in to use the chat command.</p>';
                    }
                    commandState = { command: 'chat', step: 1, data: {} };
                    promptEl.textContent = "chat> ";
                    return 'Entering chat mode... (type "exit" to quit)';
                }
            },
            inquire: {
                description: 'Start a project inquiry or ask a question.',
                execute: () => {
                    commandState = { command: 'inquire', step: 1, data: {} };
                    promptEl.textContent = "Enter your name:";
                    return 'Starting inquiry process... (type "cancel" to exit at any time)';
                }
            },
            date: {
                description: 'Displays the current date and time.',
                execute: () => `<p>${new Date().toString()}</p>`
            },
            clear: {
                description: 'Clears the terminal screen.',
                execute: () => { output.innerHTML = ''; return ''; }
            },
            help: {
                description: 'Lists all available commands.',
                execute: () => {
                    let availableCommands = { ...commands };
                    if (!isAuthenticated) {
                        delete availableCommands.chat;
                    }
                    return `
                        <p class="mb-2">Available commands:</p>
                        <ul class="list-none space-y-1">
                            ${Object.keys(availableCommands).map(cmd => `<li><span class="text-cyan-400 w-24 inline-block">${cmd}</span> <span class="text-gray-400">- ${availableCommands[cmd].description}</span></li>`).join('')}
                        </ul>`;
                }
            },
            echo: {
                description: 'Prints the given text.',
                execute: (args) => `<p>${args.join(' ')}</p>`
            }
        };

        input.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                const userInput = input.value.trim();
                
                if (commandState) {
                    if (userInput.toLowerCase() === 'cancel') {
                        output.innerHTML += `<div><span class="text-gray-400">${promptEl.textContent}</span> ${userInput}</div>`;
                        output.innerHTML += `<div>Process canceled.</div>`;
                        resetCommandState();
                    } else if (commandState.command === 'inquire') {
                        handleInquiry(userInput);
                    } else if (commandState.command === 'login') {
                        handleLogin(userInput);
                    } else if (commandState.command === 'signup') {
                        handleSignup(userInput);
                    } else if (commandState.command === 'chat') {
                        if (userInput.toLowerCase() === 'exit') {
                            resetCommandState();
                            return;
                        }
                        await handleChat(userInput);
                    }
                } else {
                    const [command, ...args] = userInput.split(' ').filter(c => c);
                    output.innerHTML += `
                        <div class="flex items-center">
                            <p class="text-green-400">root@nullrootvector:~$
                            <p class="ml-2">${userInput}</p>
                        </div>`;

                    if (commands[command]) {
                        const result = await commands[command].execute(args);
                        if(result) output.innerHTML += `<div class="pl-2">${result}</div>`;
                    } else if (command) {
                        output.innerHTML += `<p class="pl-2">Command not found: ${command}. Type 'help' for a list of commands.</p>`;
                    }
                }
                
                input.value = '';
                terminalBody.scrollTop = terminalBody.scrollHeight;
            }
        });

        async function initialBoot() {
            await checkAuth();
            await fetchBlogPosts();
            output.innerHTML += await commands.fetch.execute();
            output.innerHTML += `<p class="mt-4">Welcome to nullrootvector.dev. Type 'help' to see available commands.</p>`;
            terminalBody.scrollTop = terminalBody.scrollHeight;
        }

        initialBoot();

    </script>
</body>
</html>